<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Azure VNet Subnet Calculator</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f4f4f4; }
    .container { max-width: 800px; margin: auto; background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label, input, select { display: block; margin-top: 1rem; width: 100%; }
    button { margin-top: 2rem; padding: 0.75rem; width: 100%; font-weight: bold; }
    table { width: 100%; margin-top: 2rem; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 0.75rem; text-align: left; }
    th { background: #0078d4; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Azure VNet Subnet Calculator</h1>
    <label for="addressSpace">VNet Address Space (CIDR)</label>
    <input type="text" id="addressSpace" placeholder="e.g., 10.0.0.0/16" />

    <label for="vmIps">Number of IPs for VMs</label>
    <input type="number" id="vmIps" placeholder="e.g., 200" />

    <label><input type="checkbox" id="includeBastion" /> Include Azure Bastion</label>
    <label><input type="checkbox" id="includeGateway" /> Include VPN Gateway</label>
    <label><input type="checkbox" id="includeFirewall" /> Include Azure Firewall</label>

    <button onclick="calculateSubnets()">Calculate Subnets</button>

    <table id="resultTable" style="display:none">
      <thead>
        <tr><th>Subnet Name</th><th>Address Range</th><th>CIDR</th><th>Purpose</th></tr>
      </thead>
      <tbody id="results"></tbody>
    </table>
  </div>

  <script>
    function nextSubnet(base, size) {
      const [ip, prefix] = base.split("/");
      const parts = ip.split(".").map(Number);
      const increment = Math.pow(2, 32 - size);
      const ipInt = parts[0]*16777216 + parts[1]*65536 + parts[2]*256 + parts[3];
      const next = ipInt + increment;
      return [(next >>> 24) + "." + ((next >> 16) & 255) + "." + ((next >> 8) & 255) + "." + (next & 255), size];
    }

    function calculateSubnets() {
      const addressSpace = document.getElementById("addressSpace").value.trim();
      const vmIps = parseInt(document.getElementById("vmIps").value);
      const includeBastion = document.getElementById("includeBastion").checked;
      const includeGateway = document.getElementById("includeGateway").checked;
      const includeFirewall = document.getElementById("includeFirewall").checked;

      let [base, prefix] = addressSpace.split("/");
      prefix = parseInt(prefix);

      if (!base || isNaN(prefix)) return alert("Invalid CIDR block");

      const results = [];
      let currentSubnet = base;

      if (!isNaN(vmIps)) {
        const vmCidr = 32 - Math.ceil(Math.log2(vmIps + 5));
        results.push({ name: "VM Subnet", ip: currentSubnet, cidr: vmCidr, purpose: "VMs" });
        currentSubnet = nextSubnet(currentSubnet + "/" + vmCidr, vmCidr)[0];
      }

      if (includeBastion) {
        results.push({ name: "Azure Bastion", ip: currentSubnet, cidr: 26, purpose: "Bastion" });
        currentSubnet = nextSubnet(currentSubnet + "/26", 26)[0];
      }

      if (includeGateway) {
        results.push({ name: "GatewaySubnet", ip: currentSubnet, cidr: 27, purpose: "VPN Gateway" });
        currentSubnet = nextSubnet(currentSubnet + "/27", 27)[0];
      }

      if (includeFirewall) {
        results.push({ name: "AzureFirewallSubnet", ip: currentSubnet, cidr: 26, purpose: "Firewall" });
        currentSubnet = nextSubnet(currentSubnet + "/26", 26)[0];
      }

      document.getElementById("resultTable").style.display = "table";
      const tbody = document.getElementById("results");
      tbody.innerHTML = "";
      for (const row of results) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.name}</td><td>${row.ip}/${row.cidr}</td><td>/${row.cidr}</td><td>${row.purpose}</td>`;
        tbody.appendChild(tr);
      }
    }
  </script>
</body>
</html>
