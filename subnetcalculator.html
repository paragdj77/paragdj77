<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Azure VNet Subnet Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1, h2 { color: #2c3e50; }
    label, input, select, button { margin: 10px 0; display: block; }
    #result { background: #f4f4f4; padding: 10px; border: 1px solid #ccc; margin-top: 20px; white-space: pre-line; }
  </style>
</head>
<body>
  <h1>Azure VNet Subnet Calculator</h1>
  <p>Enter your desired address space and number of VMs to estimate required subnets including Bastion, Gateway, and Firewall.</p>

  <label for="vnet">VNet Address Space (e.g. 10.0.0.0/16):</label>
  <input type="text" id="vnet" placeholder="10.0.0.0/16" />

  <label for="vmCount">Number of VMs:</label>
  <input type="number" id="vmCount" placeholder="e.g. 100" />

  <label><input type="checkbox" id="includeBastion" /> Include Bastion Subnet</label>
  <label><input type="checkbox" id="includeFirewall" /> Include Firewall Subnet</label>
  <label><input type="checkbox" id="includeGateway" /> Include Gateway Subnet</label>

  <button onclick="calculateSubnets()">Calculate Subnets</button>

  <div id="result"></div>

  <script>
    function cidrFromHosts(hosts) {
      let bits = 32;
      while ((2 ** (32 - bits)) - 5 < hosts) bits--;
      return bits;
    }

    function calculateSubnets() {
      const vnet = document.getElementById('vnet').value.trim();
      const vmCount = parseInt(document.getElementById('vmCount').value);
      const includeBastion = document.getElementById('includeBastion').checked;
      const includeFirewall = document.getElementById('includeFirewall').checked;
      const includeGateway = document.getElementById('includeGateway').checked;

      if (!vnet || isNaN(vmCount) || vmCount < 1) {
        alert("Please enter valid VNet and VM count.");
        return;
      }

      let [baseIP, vnetCidr] = vnet.split('/');
      let subnets = [];
      let subnetCounter = 0;

      function nextSubnet(cidr) {
        let newSubnet = baseIP.split('.');
        newSubnet[2] = parseInt(newSubnet[2]) + subnetCounter;
        subnetCounter++;
        return `${newSubnet.join('.').replace(/\.\d+$/, '.0')}/${cidr}`;
      }

      // VM Subnet
      const totalIPsNeeded = vmCount + 5; // Azure reserves 5 IPs
      const vmCidr = cidrFromHosts(totalIPsNeeded);
      const vmSubnet = nextSubnet(vmCidr);
      subnets.push({
        name: "VM Subnet",
        cidr: vmSubnet,
        explanation: `For ${vmCount} VMs, needing ${totalIPsNeeded} total IPs (including Azure reserved), a /${vmCidr} is selected.`
      });

      if (includeBastion) {
        subnets.push({
          name: "Azure Bastion Subnet",
          cidr: nextSubnet(27),
          explanation: "Azure Bastion requires a /27 or larger. Reserved range: 32 IPs."
        });
      }
      if (includeFirewall) {
        subnets.push({
          name: "Azure Firewall Subnet",
          cidr: nextSubnet(26),
          explanation: "FirewallSubnet requires a /26 or larger. Reserved range: 64 IPs."
        });
      }
      if (includeGateway) {
        subnets.push({
          name: "GatewaySubnet",
          cidr: nextSubnet(27),
          explanation: "GatewaySubnet typically uses /27 or /28 depending on scale. Reserved range: 32 IPs."
        });
      }

      let output = `Subnets calculated from VNet ${vnet} for ${vmCount} VM(s):\n\n`;
      subnets.forEach(s => {
        output += `ðŸ”¹ ${s.name}: ${s.cidr}\n   ${s.explanation}\n\n`;
      });

      document.getElementById('result').innerText = output;
    }
  </script>
</body>
</html>